!function(h){"use strict";var e={_inputLatId:"",_inputLngId:"",_mapWrapperId:"",_mapSearchId:"",_mapCanvasId:"",_zoomLevel:16,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",init:function(e){var a=this;a._params=e,a._inputLatSel="woocommerce_wcsdm_origin_lat",a._inputLngSel="woocommerce_wcsdm_origin_lng",a._mapWrapperSel="wcsdm-map-wrapper",a._mapSearchSel="wcsdm-map-search",a._mapCanvasSel="wcsdm-map-canvas",a._params.show_settings&&setTimeout(function(){for(var e=!1,t=h(document).find(".wc-shipping-zone-method-type"),o=0;o<t.length;o++){var n=t[o];if(h(n).text()===a._params.method_title)return h(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(e=!0)}e||(h(".wc-shipping-zone-add-method").trigger("click"),h('select[name="add_method_id"]').val(a._params.method_id).trigger("change"))},200),h(document).on("click",".wc-shipping-zone-method-settings",function(){if(h(this).closest("tr").find(".wc-shipping-zone-method-type").text()!==a._params.method_title)return!1;h("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),a._initGoogleMaps()}),h(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){switch(h(this).val()){case"metric":h(".field-group.distance .field-group-icon").text("KM"),h('option[value="per_unit"]').text(a._params.txt.per_unit_km);break;default:h(".field-group.distance .field-group-icon").text("MI"),h('option[value="per_unit"]').text(a._params.txt.per_unit_mi)}}),h(document).on("change","#"+a._inputLatSel+", #"+a._inputLngSel,function(){if(h(".gm-err-content").length)return!1;a._initGoogleMaps()}),h(document).on("change","#rates-list-table thead .select-item",a._toggleRateRowsBulk),h(document).on("change","#rates-list-table tbody .select-item",a._toggleRateRows),h(document).on("click","#rates-list-table .button.add_row",a._addRateRows),h(document).on("click","#rates-list-table .button.remove_rows",a._removeRateRows)},_initGoogleMaps:function(){var t=this;h("#"+t._mapWrapperSel).show().siblings(".description").hide();try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";t._buildGoogleMaps()}catch(e){var o="https://maps.googleapis.com/maps/api/js?key="+h("#woocommerce_wcsdm_gmaps_api_key").val()+"&libraries=geometry,places&&language="+t._params.language;h.getScript(o,function(){t._buildGoogleMaps()})}},_buildGoogleMaps:function(){var o=this,e=-6.175392,t=106.827153,n=h("#"+o._inputLatSel).val(),a=h("#"+o._inputLngSel).val(),r={lat:n=n.length?parseFloat(n):e,lng:a=a.length?parseFloat(a):t},i=wp.template(o._mapCanvasSel),c=wp.template(o._mapSearchSel);h("#"+o._mapCanvasSel).length||h("#"+o._mapWrapperSel).append(i({map_canvas_id:o._mapCanvasSel}));var s=[],d=new google.maps.Map(document.getElementById(o._mapCanvasSel),{center:r,zoom:o._zoomLevel,mapTypeId:"roadmap"}),p=new google.maps.Marker({map:d,position:r,draggable:!0,icon:o._params.marker}),g=new google.maps.InfoWindow({maxWidth:350});n===e&&a===t?(g.setContent(o._params.txt.drag_marker),g.open(d,p)):o._setLatLng(p.position,p,d,g),google.maps.event.addListener(p,"dragstart",function(){g.close()}),google.maps.event.addListener(p,"dragend",function(e){o._setLatLng(e.latLng,p,d,g)}),s.push(p),h("#"+o._mapSearchSel).length||h("#"+o._mapWrapperSel).append(c({map_search_id:o._mapSearchSel}));var l=document.getElementById(o._mapSearchSel),m=new google.maps.places.SearchBox(l);d.controls[google.maps.ControlPosition.TOP_LEFT].push(l),d.addListener("bounds_changed",function(){m.setBounds(d.getBounds())}),m.addListener("places_changed",function(){var e=m.getPlaces();if(0!==e.length){s.forEach(function(e){e.setMap(null)}),s=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(p=new google.maps.Marker({map:d,position:e.geometry.location,draggable:!0,icon:o._params.marker}),o._setLatLng(e.geometry.location,p,d,g),google.maps.event.addListener(p,"dragstart",function(){g.close()}),google.maps.event.addListener(p,"dragend",function(e){o._setLatLng(e.latLng,p,d,g)}),s.push(p),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),d.fitBounds(t)}}),setInterval(function(){h(".gm-err-content").length&&(h("#"+o._mapWrapperSel).hide().siblings(".description").show(),h("#"+o._mapSearchSel).remove(),google=void 0)},1e3)},_setLatLng:function(e,o,n,a){(new google.maps.Geocoder).geocode({latLng:e},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&(a.setContent(e[0].formatted_address),a.open(n,o),o.addListener("click",function(){a.open(n,o)}))}),n.setCenter(e),h("#"+this._inputLatSel).val(e.lat()),h("#"+this._inputLngSel).val(e.lng())},_toggleRateRowsBulk:function(e){var t=h(e.currentTarget),o=t.closest("table").find("tbody input[type=checkbox]");o.length?o.prop("checked",t.is(":checked")).trigger("change"):t.prop("checked",!t.is(":checked"))},_toggleRateRows:function(e){var t=h(e.currentTarget).closest("table"),o=t.find("thead"),n=t.find("tbody"),a=t.find("tfoot");n.find("[type=checkbox]:checked").length?a.find(".add_row").hide("fast",function(){h(this).siblings(".remove_rows").show()}):a.find(".remove_rows").hide("fast",function(){h(this).siblings(".add_row").show()}),n.find("[type=checkbox]:checked").length===n.find("[type=checkbox]").length?o.find("input[type=checkbox]").prop("checked",!0):o.find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(e){e.preventDefault(),h("#rates-list-table tbody").append(wp.template("rates-list-input-table-row")).find("tr:last-child .field-distance").focus(),h("#woocommerce_wcsdm_gmaps_api_units").trigger("change")},_removeRateRows:function(e){e.preventDefault();var t=h(e.currentTarget),o=t.closest("table");t.hide("fast",function(){h(this).siblings(".add_row").show()}),o.find("thead [type=checkbox]").prop("checked",!1),o.find("tbody [type=checkbox]:checked").each(function(e,t){h(t).closest("tr").remove()})},_encode:function(e){var t,o,n,a,r,i,c,s="",d=0;for(e=this._utf8_encode(e);d<e.length;)a=(t=e.charCodeAt(d++))>>2,r=(3&t)<<4|(o=e.charCodeAt(d++))>>4,i=(15&o)<<2|(n=e.charCodeAt(d++))>>6,c=63&n,isNaN(o)?i=c=64:isNaN(n)&&(c=64),s=s+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(c);return s},_decode:function(e){var t,o,n,a,r,i,c="",s=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");s<e.length;)t=this._keyStr.indexOf(e.charAt(s++))<<2|(a=this._keyStr.indexOf(e.charAt(s++)))>>4,o=(15&a)<<4|(r=this._keyStr.indexOf(e.charAt(s++)))>>2,n=(3&r)<<6|(i=this._keyStr.indexOf(e.charAt(s++))),c+=String.fromCharCode(t),64!==r&&(c+=String.fromCharCode(o)),64!==i&&(c+=String.fromCharCode(n));return c=this._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);n<128?t+=String.fromCharCode(n):(127<n&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",o=0,n=0,a=0,r=0;o<e.length;)(n=e.charCodeAt(o))<128?(t+=String.fromCharCode(n),o++):191<n&&n<224?(a=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&a),o+=2):(a=e.charCodeAt(o+1),r=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&a)<<6|63&r),o+=3);return t}};h(document).ready(function(){e.init(wcsdm_params)})}(jQuery);